/*!*
 * MCalendar v1.1.0 (https://github.com/dengliran/MCalendar.git)
 * Created by Deng Liran on 2017/8
 * Licensed under the MIT license
 */
!function(t,e){"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?module.exports=e():t.MCalendar=e()}(this,function(){function t(e,a){return this instanceof t?this.init(e,a):new t(e,a)}var e={callback:function(){}},a=!1,n=!1,d=void 0,r=void 0,i=void 0;return t.prototype.configure=function(t){var a,n;for(a in t)void 0!==(n=t[a])&&t.hasOwnProperty(a)&&(e[a]=n);return this},t.prototype.init=function(t,e){return this.configure(e),this._eventBind(t),this},t.prototype.render=function(t){if(!r||!i){var e=new Date;r=e.getFullYear(),i=e.getMonth()+1}return 0===t?i--:1===t&&i++,0===i&&(i=12,r--),i>12&&(i=1,r++),this._dateModel(r,i)},t.prototype._dateModel=function(t,e){var a=[],n=new Date(t,e-1,1),d=n.getDay();0===d&&(d=7);for(var r=new Date(t,e-1,0),i=r.getDate(),o=d-1,c=new Date(t,e,0),l=c.getDate(),s=0;s<42;s++){var u=s+1-o,h=u,m=e;u<=0?(m=e-1,h=i+u):u>l&&(m=e+1,h-=l),0===m&&(m=12),13===m&&(m=1),a.push({month:m,date:u,showDate:h})}return{year:t,month:e,days:a}},t.prototype.viewManage=function(t){var e=document.createElement("div");e.className="MCalendar-container";e.innerHTML+='<div id="MCalendar-mask" class="fadeIn"></div>\t\t\t\t<div id="MCalendar-content" class="sideInBottom">\t\t\t\t<div class="MCalendar-hd">\t\t\t\t\t<a href="javascript:;" id="MCalendar__cancel">取消</a>\t\t\t\t\t\t<div class="MCalendar-hd__tools">\t\t\t\t\t\t\t<a href="javascript:;" id="MCalendar-hd__prev"></a>\t\t\t\t\t\t\t<span id="MCalendar-hd__ym"></span>\t\t\t\t\t\t\t<a href="javascript:;" id="MCalendar-hd__next"></a>\t\t\t\t\t\t</div>\t\t\t\t\t<a href="javascript:;" id="MCalendar__enter">确认</a>\t\t\t\t</div>\t\t\t\t<table class="MCalendar-bd">\t\t\t\t\t<thead>\t\t\t\t\t\t<tr>\t\t\t\t\t\t\t<th>一</th>\t\t\t\t\t\t\t<th>二</th>\t\t\t\t\t\t\t<th>三</th>\t\t\t\t\t\t\t<th>四</th>\t\t\t\t\t\t\t<th>五</th>\t\t\t\t\t\t\t<th>六</th>\t\t\t\t\t\t\t<th>日</th>\t\t\t\t\t\t</tr>\t\t\t\t\t</thead>\t\t\t\t\t<tbody id="MCalendar-bd__tbody">\t\t\t\t\t</tbody>\t\t\t\t</table>\t\t\t\t<div>\n',document.body.appendChild(e),this.viewBind(t)},t.prototype.viewBind=function(t){for(var e="",a=0;a<t.days.length;a++){var n=t.year+"-"+t.days[a].month+"-"+t.days[a].showDate;a%7==0&&(e+="<tr>"),e+='<td data-current="'+n+'" class="'+(t.month==t.days[a].month?"":"MCalendar-across")+(this._checkInSelectedDate(n)?" MCalendar-active":"")+'"><span>'+t.days[a].showDate+"</span></td>",a%7==6&&(e+="</tr>")}document.getElementById("MCalendar-hd__ym").innerHTML=t.year+"年"+t.month+"月",document.getElementById("MCalendar-bd__tbody").innerHTML=e},t.prototype._checkInSelectedDate=function(t){for(var e=0;e<d.length;e++)if(d[e]===t)return!0;return!1},t.prototype._clearAllSelectedDate=function(){return d=[],this},t.prototype.viewClose=function(){a&&!n&&(document.getElementById("MCalendar-content").className+="sideOutBottom",document.getElementById("MCalendar-mask").className+="fadeOut",n=!0,document.getElementById("MCalendar-content").addEventListener("animationend",function(){document.body.removeChild(document.querySelector(".MCalendar-container")),a=!1,n=!1}),this._clearAllSelectedDate())},t.prototype._eventBind=function(t){function n(t){if(!a){d=this.getAttribute("data-selectedDate")?this.getAttribute("data-selectedDate").split(","):[];var n=r.render(),i=t.target;r.viewManage(n),document.getElementById("MCalendar-mask").addEventListener("click",function(){r.viewClose()}),document.getElementById("MCalendar__cancel").addEventListener("click",function(){r.viewClose()}),document.getElementById("MCalendar-hd__prev").addEventListener("click",function(){var t=r.render(0);r.viewBind(t)}),document.getElementById("MCalendar-hd__next").addEventListener("click",function(){var t=r.render(1);r.viewBind(t)}),document.getElementById("MCalendar-bd__tbody").addEventListener("click",function(t){var e="SPAN"==t.target.tagName?t.target.parentNode:t.target;if("TD"!==e.tagName)return!1;if(/MCalendar-active/g.test(e.className)){e.className=e.className.replace("MCalendar-active","");for(var a=0;a<d.length;a++)d[a]===e.dataset.current&&d.splice(a,1)}else e.className+=" MCalendar-active",d.push(e.dataset.current)}),document.getElementById("MCalendar__enter").addEventListener("click",function(){"INPUT"===i.tagName?i.value=d.join(","):i.innerHTML=d.join(","),i.setAttribute("data-selecteddate",d),e.callback(d),r.viewClose()}),document.getElementById("MCalendar-content").addEventListener("animationend",function(){this.className=this.className.replace("sideInBottom","");var t=document.getElementById("MCalendar-mask");t.className=t.className.replace("fadeIn",""),a=!0})}}for(var r=this,i=document.querySelectorAll(t),o=0;o<i.length;o++)i[o].addEventListener("click",n)},t});